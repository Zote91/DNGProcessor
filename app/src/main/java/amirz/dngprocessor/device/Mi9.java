package amirz.dngprocessor.device;

import android.util.SparseArray;

import amirz.dngprocessor.params.ProcessParams;
import amirz.dngprocessor.params.SensorParams;
import amirz.dngprocessor.parser.TIFFTag;

public class Mi9 implements DeviceMap.Device {
    @Override
    public boolean isModel(String model) {
        return model.equals("MI 9");
    }

    @Override
    public void sensorCorrection(SparseArray<TIFFTag> tags, SensorParams sensor) {
        sensor.calibrationTransform1 = new float[] {
                128f / 128f, 0f / 128f, 0f / 128f,
                0f / 128f, 128f / 128f, 0f / 128f,
                0f / 128f, 0f / 128f, 128f / 128f,
        };
        sensor.calibrationTransform2 = new float[] {
                128f / 128f, 0f / 128f, 0f / 128f,
                0f / 128f, 128f / 128f, 0f / 128f,
                0f / 128f, 0f / 128f, 128f / 128f,
        };
        sensor.colorMatrix1 = new float[] {
                142f / 128f, -67f / 128f, -22f / 128f,
                -124f / 128f, 240f / 128f, 5f / 128f,
                6f / 128f, -22f / 128f, 115f / 128f,
        };
        sensor.colorMatrix2 = new float[] {
                184f / 128f, -87f / 128f, -28f / 128f,
                -124f / 128f, 240f / 128f, 5f / 128f,
                5f / 128f, -18f / 128f, 94f / 128f,
        };
        sensor.forwardTransform1 = new float[] {
                56f / 128f, 49f / 128f, 18f / 128f,
                28f / 128f, 92f / 128f, 8f / 128f,
                2f / 128f, 12f / 128f, 91f / 128f,
        };
        sensor.forwardTransform2 = new float[] {
                56f / 128f, 49f / 128f, 18f / 128f,
                28f / 128f, 92f / 128f, 8f / 128f,
                2f / 128f, 12f / 128f, 91f / 128f,
        };
        if (sensor.gainMap == null) {
            // Extracted from a Camera2 photo
            sensor.gainMap = new float[]{
                    3.8092449f, 3.5097656f, 3.5003254f, 3.3313801f, 3.5302734f, 3.2464192f, 3.2405598f, 3.0826824f, 3.2705078f, 3.0166016f, 3.014323f, 2.8782551f, 3.0445964f, 2.8258464f, 2.8190105f, 2.704427f, 2.8733723f, 2.681966f,
                    2.6777344f, 2.5810547f, 2.7389324f, 2.5784504f, 2.5738933f, 2.489909f, 2.6399739f, 2.5029297f, 2.4973958f, 2.4222004f, 2.5804036f, 2.4589844f, 2.4541016f, 2.383789f, 2.5615234f, 2.444987f, 2.4397786f, 2.3707683f,
                    2.5810547f, 2.459961f, 2.4557292f, 2.385091f, 2.647461f, 2.5133464f, 2.5071614f, 2.4313152f, 2.7470703f, 2.5888672f, 2.5843098f, 2.4990234f, 2.8802083f, 2.6966145f, 2.6946614f, 2.5947266f, 3.053711f, 2.8427734f,
                    2.8401692f, 2.7210286f, 3.2770183f, 3.0305989f, 3.0296223f, 2.8876953f, 3.532552f, 3.258138f, 3.2591145f, 3.0966797f, 3.8105469f, 3.5123699f, 3.5162761f, 3.3307292f, 3.6113281f, 3.3144531f, 3.3082683f, 3.1455078f,
                    3.3085938f, 3.0423176f, 3.0403645f, 2.9042969f, 3.0514324f, 2.8203125f, 2.8177083f, 2.708659f, 2.8401692f, 2.6445312f, 2.6416016f, 2.552409f, 2.671875f, 2.5104167f, 2.507487f, 2.4326172f, 2.5361328f, 2.4088542f,
                    2.404948f, 2.3427734f, 2.431966f, 2.3310547f, 2.328125f, 2.273763f, 2.3671875f, 2.2838542f, 2.2805989f, 2.2327473f, 2.3453777f, 2.2685547f, 2.2652996f, 2.2194011f, 2.3671875f, 2.2854817f, 2.2822266f, 2.2333984f,
                    2.4313152f, 2.333659f, 2.3310547f, 2.2760417f, 2.532552f, 2.4114583f, 2.4085286f, 2.34375f, 2.6676433f, 2.5172527f, 2.5162761f, 2.438802f, 2.8395183f, 2.6546223f, 2.6552734f, 2.5608723f, 3.0442708f, 2.8300781f,
                    2.8323567f, 2.7203777f, 3.3118489f, 3.0602214f, 3.0641277f, 2.929362f, 3.614909f, 3.334961f, 3.3365886f, 3.173177f, 3.420573f, 3.1445312f, 3.141927f, 2.9850261f, 3.1210938f, 2.8795574f, 2.8782551f, 2.7636719f,
                    2.8759766f, 2.6715496f, 2.6695964f, 2.5738933f, 2.6708984f, 2.5032551f, 2.5019531f, 2.4241536f, 2.5009766f, 2.3727214f, 2.3710938f, 2.3066406f, 2.3610027f, 2.266927f, 2.264323f, 2.2128906f, 2.2561848f, 2.1907551f,
                    2.1884766f, 2.1468098f, 2.1884766f, 2.1432292f, 2.1402996f, 2.1048176f, 2.165039f, 2.126302f, 2.1233723f, 2.0904949f, 2.1868489f, 2.1429036f, 2.1409504f, 2.1048176f, 2.2509766f, 2.1910808f, 2.1884766f, 2.1458333f,
                    2.3535156f, 2.2682292f, 2.266927f, 2.2138672f, 2.493164f, 2.3766277f, 2.3766277f, 2.3115234f, 2.664388f, 2.5107422f, 2.5120442f, 2.4339192f, 2.8707683f, 2.6796875f, 2.6826172f, 2.5852864f, 3.1191406f, 2.8929036f,
                    2.898112f, 2.7792969f, 3.428711f, 3.1695964f, 3.1777344f, 3.0270183f, 3.266927f, 3.0139973f, 3.0110676f, 2.869466f, 2.9752605f, 2.758138f, 2.7578125f, 2.6536458f, 2.7441406f, 2.5628254f, 2.5621746f, 2.478841f,
                    2.5384114f, 2.3984375f, 2.3968098f, 2.3313801f, 2.3632812f, 2.2639973f, 2.2623699f, 2.210612f, 2.2210286f, 2.1595051f, 2.15625f, 2.116211f, 2.114909f, 2.0817058f, 2.0797527f, 2.046875f, 2.0478516f, 2.0332031f,
                    2.0309246f, 2.0042317f, 2.022461f, 2.0152996f, 2.0136719f, 1.9902344f, 2.045573f, 2.0332031f, 2.0315754f, 2.0042317f, 2.1113281f, 2.0820312f, 2.0804036f, 2.0475261f, 2.2158203f, 2.1621094f, 2.1608074f, 2.1204426f,
                    2.3544922f, 2.2675781f, 2.2672527f, 2.2145183f, 2.529948f, 2.4039714f, 2.4052734f, 2.3372395f, 2.7324219f, 2.5657551f, 2.5696614f, 2.4833984f, 2.9752605f, 2.7708333f, 2.7750652f, 2.6692708f, 3.2753906f, 3.041341f,
                    3.0458984f, 2.911784f, 3.1712239f, 2.9342449f, 2.9309895f, 2.7985027f, 2.8870442f, 2.6881511f, 2.6878254f, 2.5930989f, 2.6516926f, 2.4921875f, 2.4915364f, 2.4192708f, 2.4446614f, 2.3287761f, 2.3277996f, 2.2714844f,
                    2.2666016f, 2.1940105f, 2.1923828f, 2.150716f, 2.1243489f, 2.0885417f, 2.0859375f, 2.054362f, 2.014323f, 2.0058594f, 2.0029297f, 1.9798177f, 1.9446615f, 1.9544271f, 1.952474f, 1.9348959f, 1.9215494f, 1.938151f,
                    1.9358724f, 1.9208984f, 1.9440104f, 1.9554037f, 1.953125f, 1.9355469f, 2.0113933f, 2.006836f, 2.0052083f, 1.9814453f, 2.1201172f, 2.0914714f, 2.0898438f, 2.0572917f, 2.2607422f, 2.1982422f, 2.1979167f, 2.1552734f,
                    2.4345703f, 2.3326824f, 2.3343098f, 2.2766926f, 2.6422527f, 2.4970703f, 2.4996746f, 2.4248047f, 2.8841145f, 2.6995442f, 2.7047527f, 2.6083984f, 3.1751301f, 2.9567058f, 2.9635417f, 2.8378906f, 3.1031902f, 2.8766277f,
                    2.8723958f, 2.75f, 2.8238933f, 2.6354167f, 2.635091f, 2.546875f, 2.5914714f, 2.4446614f, 2.4433594f, 2.3769531f, 2.3785808f, 2.2789714f, 2.2776692f, 2.2291667f, 2.2014973f, 2.146159f, 2.1442058f, 2.110677f,
                    2.056966f, 2.039388f, 2.0361328f, 2.0139973f, 1.9446615f, 1.9534506f, 1.9508463f, 1.9352213f, 1.8779297f, 1.9033203f, 1.9010416f, 1.889974f, 1.8557943f, 1.8867188f, 1.8844401f, 1.8759766f, 1.8785807f, 1.9039713f,
                    1.9020182f, 1.8902994f, 1.9440104f, 1.9554037f, 1.953125f, 1.9365234f, 2.0533855f, 2.0410156f, 2.039388f, 2.0149739f, 2.1953125f, 2.149414f, 2.1497395f, 2.114909f, 2.369466f, 2.282552f, 2.2841797f, 2.234375f,
                    2.5817058f, 2.4501953f, 2.4527996f, 2.385091f, 2.826823f, 2.6513672f, 2.6555989f, 2.5677083f, 3.110677f, 2.904948f, 2.9091797f, 2.7949219f, 3.0673828f, 2.8496094f, 2.8466797f, 2.7298176f, 2.7975261f, 2.6113281f,
                    2.6103516f, 2.525716f, 2.5618489f, 2.4202473f, 2.4189453f, 2.3551433f, 2.3499348f, 2.2565105f, 2.2545574f, 2.2096355f, 2.173177f, 2.1246746f, 2.1223958f, 2.0930989f, 2.0292969f, 2.0175781f, 2.0149739f, 1.9951172f,
                    1.9179688f, 1.9319662f, 1.9287109f, 1.9166666f, 1.8525391f, 1.8818359f, 1.8789062f, 1.8710938f, 1.8326823f, 1.8658854f, 1.8636068f, 1.8561198f, 1.8528646f, 1.8824869f, 1.8795573f, 1.8714193f, 1.9186198f, 1.9339193f,
                    1.9313151f, 1.9182943f, 2.0250652f, 2.0175781f, 2.015625f, 1.9947916f, 2.1669922f, 2.1269531f, 2.126302f, 2.0953777f, 2.3417969f, 2.2597656f, 2.260091f, 2.2148438f, 2.555013f, 2.4267578f, 2.428711f, 2.3645833f,
                    2.7991536f, 2.6266277f, 2.6295574f, 2.545573f, 3.084961f, 2.8792317f, 2.882487f, 2.7714844f, 3.1015625f, 2.8759766f, 2.8704426f, 2.7496746f, 2.8245442f, 2.631836f, 2.6321614f, 2.5452473f, 2.5888672f, 2.4407551f,
                    2.4391277f, 2.375f, 2.3756511f, 2.2753906f, 2.274414f, 2.226237f, 2.2001953f, 2.1442058f, 2.1422527f, 2.1090496f, 2.055664f, 2.036784f, 2.0335286f, 2.0110676f, 1.9472656f, 1.9541016f, 1.9511719f, 1.9365234f,
                    1.8776041f, 1.9010416f, 1.8987631f, 1.8886719f, 1.8548177f, 1.8831381f, 1.8808594f, 1.8733724f, 1.8782552f, 1.9013672f, 1.8990885f, 1.8880209f, 1.9456381f, 1.953776f, 1.9511719f, 1.9352213f, 2.0520833f, 2.0374348f,
                    2.0351562f, 2.0113933f, 2.1936848f, 2.1448567f, 2.1442058f, 2.1100261f, 2.3691406f, 2.2796223f, 2.2802734f, 2.2317708f, 2.5830078f, 2.4466145f, 2.4482422f, 2.383789f, 2.8287761f, 2.6497395f, 2.6526692f, 2.5686848f,
                    3.1158855f, 2.9039714f, 2.9059246f, 2.7991536f, 3.1803386f, 2.9423828f, 2.9378254f, 2.8066406f, 2.897461f, 2.6923828f, 2.6910808f, 2.5999348f, 2.6585286f, 2.4947917f, 2.4941406f, 2.4225261f, 2.447591f, 2.3291016f,
                    2.328125f, 2.2727864f, 2.2692058f, 2.1933594f, 2.1920574f, 2.1520183f, 2.1272786f, 2.0898438f, 2.0865886f, 2.0579426f, 2.0201824f, 2.0091145f, 2.0065105f, 1.985026f, 1.9514974f, 1.9576823f, 1.9547526f, 1.9384766f,
                    1.9280599f, 1.9391276f, 1.9378256f, 1.9241537f, 1.9521484f, 1.9580078f, 1.9557291f, 1.9394531f, 2.0195312f, 2.0094402f, 2.007487f, 1.9853516f, 2.1240234f, 2.0891926f, 2.0875652f, 2.0576172f, 2.2639973f, 2.195638f,
                    2.194987f, 2.1546223f, 2.4404297f, 2.3313801f, 2.3320312f, 2.2776692f, 2.6526692f, 2.5009766f, 2.5022786f, 2.430013f, 2.900716f, 2.7054036f, 2.7080078f, 2.6184895f, 3.1979167f, 2.9729817f, 2.974284f, 2.8603516f,
                    3.2871094f, 3.0292969f, 3.0263672f, 2.885091f, 2.9941406f, 2.7675781f, 2.7675781f, 2.6634114f, 2.7519531f, 2.5657551f, 2.5651042f, 2.4837239f, 2.5462239f, 2.4000652f, 2.3997395f, 2.3343098f, 2.3684895f, 2.2652996f,
                    2.2633464f, 2.2128906f, 2.2259114f, 2.1608074f, 2.157552f, 2.1184895f, 2.123698f, 2.0859375f, 2.0823567f, 2.0517578f, 2.0572917f, 2.0377605f, 2.0348308f, 2.010091f, 2.0345051f, 2.0221355f, 2.0201824f, 1.9980469f,
                    2.0585938f, 2.039388f, 2.036784f, 2.0126953f, 2.1217449f, 2.084961f, 2.0820312f, 2.0527344f, 2.2259114f, 2.163086f, 2.1604817f, 2.1227214f, 2.3626301f, 2.2682292f, 2.2666016f, 2.2171223f, 2.5384114f, 2.4029949f,
                    2.4036458f, 2.3391926f, 2.7460938f, 2.5696614f, 2.5709636f, 2.4882812f, 2.9960938f, 2.7828777f, 2.7858074f, 2.6829426f, 3.305013f, 3.0602214f, 3.0647786f, 2.9355469f, 3.4381511f, 3.154948f, 3.1526692f, 2.9892578f,
                    3.1315105f, 2.883138f, 2.881836f, 2.7607422f, 2.8782551f, 2.6673176f, 2.6653645f, 2.5690105f, 2.6754558f, 2.5006511f, 2.4973958f, 2.4192708f, 2.5032551f, 2.366862f, 2.3632812f, 2.2998047f, 2.3613281f, 2.2620442f,
                    2.2565105f, 2.2070312f, 2.2558594f, 2.1842449f, 2.1783855f, 2.1383464f, 2.1927083f, 2.140625f, 2.135091f, 2.0999348f, 2.1712239f, 2.1256511f, 2.1207683f, 2.0891926f, 2.1940105f, 2.1425781f, 2.1376953f, 2.1044922f,
                    2.257487f, 2.1878254f, 2.1822917f, 2.1438801f, 2.3583984f, 2.2636719f, 2.2584636f, 2.2125652f, 2.4967449f, 2.3701172f, 2.366862f, 2.3079426f, 2.6669922f, 2.5042317f, 2.5019531f, 2.4277344f, 2.8766277f, 2.6767578f,
                    2.6751301f, 2.5807292f, 3.135091f, 2.8990886f, 2.9003906f, 2.7845051f, 3.461263f, 3.1920574f, 3.1917317f, 3.0478516f, 3.6367188f, 3.3307292f, 3.3232422f, 3.1396484f, 3.3264973f, 3.0501301f, 3.0472004f, 2.9023438f,
                    3.0598958f, 2.819336f, 2.8147786f, 2.7014973f, 2.845052f, 2.6367188f, 2.6321614f, 2.5390625f, 2.673177f, 2.5019531f, 2.4951172f, 2.4195964f, 2.5345051f, 2.397461f, 2.3902996f, 2.3277996f, 2.4332683f, 2.3209636f,
                    2.313802f, 2.2594402f, 2.3678386f, 2.2750652f, 2.266927f, 2.2197266f, 2.3460286f, 2.2594402f, 2.2519531f, 2.2067058f, 2.366211f, 2.275716f, 2.2685547f, 2.2229817f, 2.4309895f, 2.322591f, 2.3157551f, 2.2639973f,
                    2.5338542f, 2.400716f, 2.3932292f, 2.3346355f, 2.6666667f, 2.5061848f, 2.5f, 2.430013f, 2.8375652f, 2.6445312f, 2.6399739f, 2.5527344f, 3.0559895f, 2.8304036f, 2.8258464f, 2.7164714f, 3.3313801f, 3.071289f,
                    3.070638f, 2.9342449f, 3.6611328f, 3.366211f, 3.3652344f, 3.1972656f, 3.8691406f, 3.5520833f, 3.5345051f, 3.3398438f, 3.576823f, 3.2727864f, 3.2607422f, 3.1064453f, 3.2929688f, 3.025716f, 3.0146484f, 2.8876953f,
                    3.0634766f, 2.8274739f, 2.8157551f, 2.7128906f, 2.8789062f, 2.6754558f, 2.665039f, 2.5784504f, 2.7392578f, 2.5703125f, 2.5559895f, 2.485677f, 2.6396484f, 2.4928386f, 2.4811199f, 2.4179688f, 2.5751953f, 2.447591f,
                    2.4355469f, 2.3776042f, 2.5491536f, 2.430013f, 2.4179688f, 2.3616536f, 2.5735676f, 2.4466145f, 2.4348958f, 2.3789062f, 2.6389973f, 2.4980469f, 2.4863281f, 2.4257812f, 2.7373047f, 2.5735676f, 2.5621746f, 2.4951172f,
                    2.8776042f, 2.6865234f, 2.6761067f, 2.5953777f, 3.0598958f, 2.8385417f, 2.8284504f, 2.7320964f, 3.2942708f, 3.0423176f, 3.0315754f, 2.9176433f, 3.5732422f, 3.2877605f, 3.2792969f, 3.139323f, 3.8779297f, 3.571289f, 3.5631511f, 3.4010417f
            };
            sensor.gainMapSize = new int[] { 18, 49 };
        }
    }

    @Override
    public void processCorrection(SparseArray<TIFFTag> tags, ProcessParams process) {
        saturationCorrection(process.saturationMap);
    }

    private void saturationCorrection(float[] saturationMap) {
        float genericMult = 1.3f;
        saturationMap[0] *= genericMult;
        saturationMap[1] *= genericMult;
        saturationMap[2] *= genericMult;
        saturationMap[3] *= genericMult;
        saturationMap[4] *= genericMult;
        saturationMap[5] *= genericMult;
        saturationMap[6] *= genericMult;
        saturationMap[7] *= genericMult;
    }
}
